---
author: yingyun001
layout: post
title: "Ansible 是如何工作的"
date: 2015-10-22 11:00
category: Tools
tags:
- ansible
- open source
---

# 概述：Ansible 是如何工作的？
原文链接：http://www.ansible.com/how-ansible-works

## 什么是 ANSIBLE？

Ansible 是一个十分简单的 IT 自动化工具，它可以自动实现 [云资源配置](2015-10-22-Ansible 之云资源配置.md)，[配置管理](2015-10-22-ANSIBLE 之配置管理.md)，[应用程序配置](2015-10-22-ANSIBLE 之应用程序部署.md)，[编配](2015-10-22-Ansible 之编配.md) 还可以满足其它与 IT 有关的需求。

Ansible 从一开始就被设计为多层部署，它通过描述您系统的内容关系来模拟您的 IT 架构，而不仅仅是采用在某一时刻来管理某一个系统的方式。

Ansible 没有代理也没有额外的自定义安全架构，所以部署起来非常简单。最重要的一点就是 Ansible 使用了非常精炼的语言（YAML，以 Ansible Playbook 语言的形式），它允许您用通俗易懂的语言来描述您的自动化任务。

本章节我们将会让您快速的了解 Ansible，想了解更详细的 Ansible 知识，请见：http://docs.ansible.com/。

## 有效的体系架构

Ansible 是通过连接到您的 node 节点并推出叫作“Ansible 模块”的小程序来工作的。这些程序被写成了系统期望状态下的资源模型。然后 Ansible 执行了这些模块（默认情况下是通过 SSH）并在完成后删除这些模块。
您的模块库可以位于任何一台机器上，而且该服务器可以没有任何服务，后台程序和数据库。您可以使用您喜欢的终端程序来持续跟踪模块的变化，这里的终端程序既可以是文本编辑器也可以是一个版本控制系统。

#### ssh 密钥是您的朋友

Ansible 是支持使用密码的，但是最好的方式还是使用 ssh 代理的 SSH 密钥这种方式。尽管如此，您还是想使用 Kerberos，那也不错。登录的方式也有很多，除了 root 用户以外，您可以使用其它任何用户来登录，然后通过使用 `su` 或者 `sudo` 命令转换到其它的用户上。

Ansible 是通过“authorized_key” 模块来控制什么机器可以访问什么主机的最佳方式。当然像 kerberos 或认证管理系统虽然不是最好的方式但也可以使用。
```
ssh-agent bash
ssh-add ~/.ssh/id_rsa
```

#### 在简易的文本文件中管理您的详细目录

默认情况下，Ansible 可以通过查看一个非常简单的 INI 文件（可以将您的管理机器按照自己的意愿进行分组）就可以知道它在管理着哪些机器。

为了添加新的机器，这里不再包含 ssl 签发证书的机构，所以如果一台机器没有连接上，很明显就是 ntp 或 dns 导致的问题了。

下面是纯文本格式的库文件：
~~~bash
[webservers]
www1.example.com
www2.example.com

[dbservers]
db0.example.com
db1.example.com
~~~

#### 基础：使用 Ansible 来运行临时的并行任务

#### PlayBooks：一个简洁但很强大的  自动化语言。

#### 一个看起来想下面这样的 app_config.yml 文件的示例：

#### 扩展 Ansible：模块，插件和 API/
